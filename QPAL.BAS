DEFINT A-Z
SUB SETPAL (SEGM%, OFFS%)
REM -------------------------------------------------------------------------
REM Установка всей палитры
REM -------------------------------------------------------------------------
regx.ax = &H1012
regx.bx = &H0
regx.cx = 256
regx.es = SEGM%
regx.dx = OFFS%
InterruptX &H10, regx, regx
REM -------------------------------------------------------------------------
END SUB

DEFINT A-Z
SUB PALLOAD (FLNM$)
REM --------------------------------------------------------------------------
REM PALette LOADer ver. 3.0
REM Quick Shot Assembly ver. 1.0
REM Загрузка палитры PAL96C
REM --------------------------------------------------------------------------
FLNM$ = FLNM$ + ".PAL": P = 1
FF = FREEFILE: OPEN "B", FF, FLNM$
REM --------------------------------------------------------------------------
SEEK FF, SK + 0: GET FF, , PAL.initPAL
SEEK FF, SK + 6: GET FF, , PAL.name
SEEK FF, SK + 17: GET FF, , PAL.caption
SEEK FF, SK + 273: GET FF, , PAL.exCOL
SEEK FF, SK + 275: GET FF, , PAL.stCOL
SEEK FF, SK + 277: GET FF, , PAL.ptype
REM --------------------------------------------------------------------------
DATAS$ = SPACE$(PAL.exCOL * 3)
REM --------------------------------------------------------------------------
SEEK FF, SK + 279: GET FF, , DATAS$
REM --------------------------------------------------------------------------
CLOSE FF
REM --------------------------------------------------------------------------
FOR TMPCOL% = PAL.stCOL TO PAL.exCOL - 1
REM --------------------------------------------------------------------------
R$ = MID$(DATAS$, 0 + P, 1)
G$ = MID$(DATAS$, 1 + P, 1)
B$ = MID$(DATAS$, 2 + P, 1)
P = P + 3
REM --------------------------------------------------------------------------
PALS(TMPCOL% + 1).color = R$ + G$ + B$
REM --------------------------------------------------------------------------
NEXT TMPCOL%
REM --------------------------------------------------------------------------
SETPAL VARSEG(PALS(1).color), VARPTR(PALS(1).color)
REM --------------------------------------------------------------------------
END SUB
